import{r,p as j,j as e,y as E,T as h}from"./app-s_-qu_ji.js";import{f as v}from"./date-DbclOb_I.js";import{m as b,a as N,b as R}from"./chunk-3BLMMOBU-BAiN2-db.js";import{b as f}from"./useDialog-MPYIK-Ot.js";const g=30,D=1,a="lastDismissedReminderAt";function y(){const[p,o]=r.useState(!1),[t,x]=r.useState(null),l=r.useRef(null),k=()=>{const s=localStorage.getItem(a);return!s||Date.now()-Number(s)>=g*6e4},c=r.useCallback(async()=>{if(k())try{const{data:s}=await j.get("/overdue-guests",{params:{threshold:1}});if(!s.length){o(!1);return}const n=s.reduce((i,m)=>new Date(i.check_in_time)<new Date(m.check_in_time)?i:m),d=new Date(n.check_in_time),_=Math.floor((Date.now()-d)/36e5);x({guest:n.guest.name,checkInTime:d,hoursOverdue:_,logId:n.id}),o(!0)}catch(s){console.error("Failed to fetch overdue guests:",s)}},[]);r.useEffect(()=>{c();const s=setInterval(c,D*6e4);return()=>clearInterval(s)},[c]);const u=()=>{o(!1),localStorage.setItem(a,Date.now().toString()),clearTimeout(l.current),l.current=setTimeout(c,g*6e4)},I=()=>{t!=null&&t.logId&&E.post(route("guest.log.checkout",t.logId),{},{onSuccess:()=>{h({title:"Guest Checked Out",description:`${t.guest} has been successfully checked out.`,color:"success"}),o(!1),localStorage.removeItem(a)},onError:()=>h({title:"Checkout Failed",description:"An error occurred while checking out the guest.",color:"danger"})})};return e.jsx(b,{isOpen:p,onClose:u,placement:"center",backdrop:"blur",children:e.jsx(N,{children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Overdue Check‑out Reminder"}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:t.guest})," has not checked out after ",e.jsxs("strong",{children:[t.hoursOverdue," hour(s)"]}),"."]}),e.jsxs("p",{children:["Checked in at: ",v(t.checkInTime)]})]}),e.jsxs("div",{className:"mt-6 flex justify-center gap-3",children:[e.jsx(f,{color:"primary",onPress:I,children:"Check Out Now"}),e.jsx(f,{variant:"flat",onPress:u,children:"Remind Me Later"})]})]})})})})}export{y as A};
