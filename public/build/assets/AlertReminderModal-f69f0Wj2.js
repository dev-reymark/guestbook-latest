import{r as o,j as e,y as I,T as m}from"./app-DrNWwami.js";import{f as E}from"./date-DbclOb_I.js";import{m as v,a as b,b as N}from"./chunk-3BLMMOBU-D-PHTKql.js";import{b as h}from"./useDialog-Di36_uni.js";const f=30,R=5,a="lastDismissedReminderAt";function w(){const[g,r]=o.useState(!1),[t,x]=o.useState(null),l=o.useRef(null),p=()=>{const s=localStorage.getItem(a);return s?Date.now()-Number(s)>=f*6e4:!0},c=o.useCallback(async()=>{if(p())try{const{data:s}=await axios.get("/overdue-guests",{params:{threshold:60}});if(s.length===0){r(!1);return}const n=s.reduce((i,d)=>new Date(i.check_in_time)<new Date(d.check_in_time)?i:d),u=new Date(n.check_in_time),j=Math.floor((Date.now()-u)/36e5);x({guest:n.guest.name,checkInTime:u,hoursOverdue:j,logId:n.id}),r(!0)}catch(s){console.error("Failed to fetch overdue guests:",s)}},[]);o.useEffect(()=>{c();const s=setInterval(c,R*6e4);return()=>clearInterval(s)},[c]);const k=()=>{r(!1),localStorage.setItem(a,Date.now().toString()),clearTimeout(l.current),l.current=setTimeout(c,f*6e4)},_=()=>{t!=null&&t.logId&&I.post(route("guest.log.checkout",t.logId),{},{onSuccess:()=>{m({title:"Guest Checked Out",description:`${t.guest} has been successfully checked out.`,color:success}),r(!1),localStorage.removeItem(a)},onError:()=>m({title:"Checkout Failed",description:"An error occurred while checking out the guest.",color:danger})})};return e.jsx(v,{isOpen:g,onClose:()=>r(!1),placement:"center",backdrop:"blur",children:e.jsx(b,{children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-bold mb-2",children:"Overdue Checkâ€‘out Reminder"}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-4",children:[e.jsx("strong",{children:t.guest})," has not checked out after"," ",e.jsxs("strong",{children:[t.hoursOverdue," hour(s)"]}),"."]}),e.jsxs("p",{children:["Checked in at:"," ",E(t.checkInTime)]})]}),e.jsxs("div",{className:"mt-6 flex justify-center gap-3",children:[e.jsx(h,{color:"primary",onPress:_,children:"Check Out Now"}),e.jsx(h,{variant:"flat",onPress:k,children:"Remind Me Later"})]})]})})})})}export{w as A};
